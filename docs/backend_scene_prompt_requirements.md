# 后端 MCP 场景化 Prompt 优化需求

## 1. 目标
根据前端传递的 `scene_type` 参数，在 LLM 生成解卦结果时，动态调整 System Prompt 或 User Prompt，使解读内容更贴合场景，使用垂直领域的专业词汇，提升用户的沉浸感和专业感。

## 2. 接口参数确认
前端于 Phase 10 已支持透传以下参数：
- `scene_type`: 场景标识（枚举值）
- `question`: 用户具体问题

## 3. 场景化 Prompt 策略

后端应根据 `scene_type` 拼接不同的 Prompt 指令。

### 通用指令 (System Prompt Base)
> "你是一位精通《周易》六爻预测的国学大师。请根据用户摇出的卦象，结合纳甲法、五行生克、六神神煞进行专业解读。由于用户可能不懂易理，请用通俗易懂但保留古韵的语言解释。"

### 核心原则：逻辑一致性 (CRITICAL)
**必须确保所有板块的建议逻辑自洽，严禁出现矛盾。**
- **错误示例**：主卦为【明夷】（意为光明受损，宜韬光养晦），"宜"列表却建议"积极进取，把握机遇"，而"核心要点"又说"需低调守护"。
- **正确做法**：先定下卦象的主基调（吉/凶/平、攻/守/避），所有子模块必须围绕此基调展开。
  - 若主基调为"守"："宜"应为"宜守不宜攻"，"忌"应为"忌冒进、忌强出头"；核心要点应为"韬光养晦"。

### 场景差异化指令 (Add-on Prompts)

#### A. 问事业 (scene_type = 'career')
- **核心关注**：官鬼爻（职位/上司）、父母爻（文书/单位）、兄弟爻（竞争）。
- **语气风格**：理性、稳重、果断。
- **关键词汇库**：
  > 晋升、机遇、职场贵人、小人作祟、跳槽、创业、风口、稳扎稳打、步步高升、韬光养晦。
- **Prompt 示例**：
  > "用户正在咨询事业前程。请重点分析卦中【官鬼爻】的旺衰，判断是否有升迁之象；分析【世应关系】判断职场人际。建议使用'运筹帷幄'、'大展宏图'等职场相关成语。"

#### B. 问感情 (scene_type = 'love')
- **核心关注**：妻财爻（男测）/官鬼爻（女测）、世应关系（双方态度）、六合/六冲。
- **语气风格**：感性、温婉、细腻。
- **关键词汇库**：
  > 缘分、正缘、桃花、烂桃花、相处之道、心心相印、貌合神离、修成正果、主动出击、包容理解。
- **Prompt 示例**：
  > "用户正在咨询感情姻缘。请重点分析【世爻】与【应爻】的生克关系，判断两人是否情投意合。若有动爻，分析感情变数。建议多用温和、建议性的口吻，如'且行且珍惜'、'静待花开'。"

#### C. 问财运 (scene_type = 'wealth')
- **核心关注**：妻财爻（资金）、子孙爻（财源）、兄弟爻（劫财）。
- **语气风格**：务实、直接、谨慎。
- **关键词汇库**：
  > 正财、偏财、投资回报、落袋为安、止损、现金流、财源广进、破财免灾、谨慎理财。
- **Prompt 示例**：
  > "用户正在咨询财运投资。请重点分析【妻财爻】是否得位、得月建日辰生扶。若兄弟爻发动，务必提示'防破财'或'投资需谨慎'。直接给出'宜进'或'宜守'的建议。"

#### D. 问健康 (scene_type = 'health')
- **核心关注**：官鬼爻（病症）、子孙爻（医药/医生）、世爻（自身体质）。
- **语气风格**：关怀、严谨、平和。
- **关键词汇库**：
  > 调理、养生、五行失衡、气血、作息、静养、遵医嘱、防微杜渐、身心平衡。
- **Prompt 示例**：
  > "用户正在咨询身体健康。请通过五行分析身体薄弱环节（如金主肺、木主肝）。重点看【官鬼爻】的五行属性推断病因。**必须声明：本结果仅供参考，身体不适请务必就医。**"

#### E. 问学业 (scene_type = 'study')
- **核心关注**：父母爻（成绩/录取通知）、官鬼爻（名次）。
- **语气风格**：鼓励、积极、条理。
- **关键词汇库**：
  > 金榜题名、名列前茅、专注、心态调整、文昌位、努力回报、学业有成、更进一步。
- **Prompt 示例**：
  > "用户正在咨询学业考试。请重点分析【父母爻】（代表成绩/文书）及【官鬼爻】（代表名次）。给出具体的复习建议或心态调整建议。"

## 4. 输出结构建议 (JSON)

建议在 `analysis` 字段外，增加 `keywords` 或 `advice_tags` 字段，方便前端展示。

```json
{
  "scene_type": "career",
  "analysis": "...", // 包含上述场景化内容的完整解读
  "keywords": ["晋升有望", "贵人相助", "防口舌"], // 提炼的场景关键词
  "score": 85 // 场景相关指数（如事业运指数）
}
```
